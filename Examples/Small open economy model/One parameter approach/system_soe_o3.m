function y = system_soe_o3(x,sol1,sol2,P)
%SOE with PAC as auxiliary model
%Full version with income and interest rate shocks
%One-parameter perturbation
%This function evaluates third-order derivatives of Euler w.r.t. states

%parameters
betta = P(1);
gama = P(2);
rho_y = P(3);
rho_r = P(4);
ty = P(5);
tr = P(6);
R0 = P(7);
b_bar = P(8);
C0 = P(9);
psi1 = P(10);
psi2 = P(11);
uy_ur_corr = P(12);

%First-order solution
hb = sol1(1);
hr = sol1(2);
hy = sol1(3);

%second-order solution
hs2 = sol2(1);
hb2 = sol2(2);
hr2 = sol2(3);
hy2 = sol2(4);
hbr = sol2(5);
hby = sol2(6);
hry = sol2(7);

%third-order coeffs
hb3 = x(1);
hr3 = x(2);
hy3 = x(3);

hb2r = x(4);
hbr2 = x(5);
hb2y = x(6);
hby2 = x(7);
hr2y = x(8);
hry2 = x(9);
hbry = x(10);
hs2b = x(11);
hs2r = x(12);
hs2y = x(13);


%Equations
Ub3 =betta*gama*((hb^3*(hb3/R0 + 3*hb*hb2*psi1))/C0 + (3*hb*hb2*(psi1*hb^2 + hb2/R0))/C0 - (hb3*(R0 - hb))/(C0*R0)) - hb3*psi1 - (gama*(hb3/R0 + 3*hb*hb2*psi1))/(C0*R0) - (3*gama*hb*psi1*(psi1*hb^2 + hb2/R0))/C0 + (3*gama*hb2*psi1*(R0 - hb))/(C0*R0) + (gama*(R0 - hb)^3*(gama + 1)*(gama + 2))/(C0^3*R0^4) + (3*gama*(psi1*hb^2 + hb2/R0)*(R0 - hb)*(gama + 1))/(C0^2*R0^2) - (3*gama*hb*psi1*(R0 - hb)^2*(gama + 1))/(C0^2*R0^2) - (3*betta*gama*hb*((hb^2*(psi1*hb^2 + hb2/R0))/C0 - (hb2*(R0 - hb))/(C0*R0))*(R0 - hb)*(gama + 1))/(C0*R0) - (betta*gama*hb^3*(R0 - hb)^3*(gama + 1)*(gama + 2))/(C0^3*R0^3);
Ur3 =1/R0 - hr3*psi1 + betta*gama*((hr^3*(hb3/R0 + 3*hb*hb2*psi1))/C0 + (rho_r^3*((3*hr)/R0 - b_bar/R0 - (3*hr2)/R0 + hr3/R0 + 3*hr*hr2*psi1))/C0 + (3*hr*hr2*(psi1*hb^2 + hb2/R0))/C0 + (3*hr*rho_r^2*(hb/R0 - (2*hbr)/R0 + hbr2/R0 + hb*hr2*psi1 + 2*hbr*hr*psi1))/C0 - (hr3*(R0 - hb))/(C0*R0) + (3*hr2*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 + (3*hr^2*rho_r*(hb2r/R0 - hb2/R0 + 2*hb*hbr*psi1 + hb2*hr*psi1))/C0) - (3*gama*(hr*psi1 - 1/R0)*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/C0 - (gama*((3*hr)/R0 - b_bar/R0 - (3*hr2)/R0 + hr3/R0 + 3*hr*hr2*psi1))/(C0*R0) - betta*gama*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))^3*(gama + 1)*(gama + 2) - 3*betta*gama*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*((rho_r^2*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/C0 + (hr^2*(psi1*hb^2 + hb2/R0))/C0 - (hr2*(R0 - hb))/(C0*R0) + (2*hr*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0) + (3*gama*(hr2*psi1 + 1/R0)*(b_bar - hr))/(C0*R0) - (3*gama*(b_bar - hr)^2*(hr*psi1 - 1/R0)*(gama + 1))/(C0^2*R0^2) + (gama*(b_bar - hr)^3*(gama + 1)*(gama + 2))/(C0^3*R0^4) + (3*gama*(b_bar - hr)*(gama + 1)*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/(C0^2*R0^2);
Uy3 =betta*gama*((hy^3*(hb3/R0 + 3*hb*hb2*psi1))/C0 + (rho_y^3*(hy3/R0 + 3*hy*hy2*psi1 - 1))/C0 + (3*hy*hy2*(psi1*hb^2 + hb2/R0))/C0 + (3*hy2*rho_y*(hby/R0 + hb*hy*psi1))/C0 + (3*hy^2*rho_y*(hb2y/R0 + 2*hb*hby*psi1 + hb2*hy*psi1))/C0 + (3*hy*rho_y^2*(hby2/R0 + hb*hy2*psi1 + 2*hby*hy*psi1))/C0 - (hy3*(R0 - hb))/(C0*R0)) - hy3*psi1 - (gama*(hy3/R0 + 3*hy*hy2*psi1 - 1))/(C0*R0) - 3*betta*gama*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1)*((hy^2*(psi1*hb^2 + hb2/R0))/C0 + (rho_y^2*(psi1*hy^2 + hy2/R0 - 1))/C0 + (2*hy*rho_y*(hby/R0 + hb*hy*psi1))/C0 - (hy2*(R0 - hb))/(C0*R0)) - betta*gama*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))^3*(gama + 1)*(gama + 2) - (3*gama*hy*psi1*(psi1*hy^2 + hy2/R0 - 1))/C0 + (3*gama*hy2*psi1*(R0 - hy))/(C0*R0) + (gama*(R0 - hy)^3*(gama + 1)*(gama + 2))/(C0^3*R0^4) + (3*gama*(R0 - hy)*(gama + 1)*(psi1*hy^2 + hy2/R0 - 1))/(C0^2*R0^2) - (3*gama*hy*psi1*(R0 - hy)^2*(gama + 1))/(C0^2*R0^2);
Ub2r =betta*gama*((2*hb*hbr*(psi1*hb^2 + hb2/R0))/C0 + (hb2*hr*(psi1*hb^2 + hb2/R0))/C0 - (hb2r*(R0 - hb))/(C0*R0) + (hb^2*hr*(hb3/R0 + 3*hb*hb2*psi1))/C0 + (hb2*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 + (hb^2*rho_r*(hb2r/R0 - hb2/R0 + 2*hb*hbr*psi1 + hb2*hr*psi1))/C0) - hb2r*psi1 - (gama*(psi1*hb^2 + hb2/R0)*(hr*psi1 - 1/R0))/C0 - (gama*(hb2r/R0 - hb2/R0 + 2*hb*hbr*psi1 + hb2*hr*psi1))/(C0*R0) - (2*gama*hb*psi1*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 - betta*gama*((hb^2*(psi1*hb^2 + hb2/R0))/C0 - (hb2*(R0 - hb))/(C0*R0))*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1) + (2*gama*(R0 - hb)*(gama + 1)*(hbr/R0 - hb/R0 + hb*hr*psi1))/(C0^2*R0^2) - (gama*(R0 - hb)^2*(hr*psi1 - 1/R0)*(gama + 1))/(C0^2*R0^2) + (2*gama*hbr*psi1*(R0 - hb))/(C0*R0) + (gama*hb2*psi1*(b_bar - hr))/(C0*R0) + (gama*(psi1*hb^2 + hb2/R0)*(b_bar - hr)*(gama + 1))/(C0^2*R0^2) + (gama*(R0 - hb)^2*(b_bar - hr)*(gama + 1)*(gama + 2))/(C0^3*R0^4) - (2*betta*gama*hb*(R0 - hb)*(gama + 1)*((hb*hr*(psi1*hb^2 + hb2/R0))/C0 - (hbr*(R0 - hb))/(C0*R0) + (hb*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0))/(C0*R0) - (2*gama*hb*psi1*(R0 - hb)*(b_bar - hr)*(gama + 1))/(C0^2*R0^2) - (betta*gama*hb^2*(R0 - hb)^2*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*(gama + 2))/(C0^2*R0^2);
Ubr2 =betta*gama*((hb*hr2*(psi1*hb^2 + hb2/R0))/C0 + (2*hbr*hr*(psi1*hb^2 + hb2/R0))/C0 + (hb*rho_r^2*(hb/R0 - (2*hbr)/R0 + hbr2/R0 + hb*hr2*psi1 + 2*hbr*hr*psi1))/C0 - (hbr2*(R0 - hb))/(C0*R0) + (hb*hr^2*(hb3/R0 + 3*hb*hb2*psi1))/C0 + (2*hbr*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 + (2*hb*hr*rho_r*(hb2r/R0 - hb2/R0 + 2*hb*hbr*psi1 + hb2*hr*psi1))/C0) - hbr2*psi1 - (2*gama*(hr*psi1 - 1/R0)*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 - (gama*(hb/R0 - (2*hbr)/R0 + hbr2/R0 + hb*hr2*psi1 + 2*hbr*hr*psi1))/(C0*R0) - 2*betta*gama*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*((hb*hr*(psi1*hb^2 + hb2/R0))/C0 - (hbr*(R0 - hb))/(C0*R0) + (hb*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0) - (gama*hb*psi1*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/C0 + (gama*(hr2*psi1 + 1/R0)*(R0 - hb))/(C0*R0) + (2*gama*(b_bar - hr)*(gama + 1)*(hbr/R0 - hb/R0 + hb*hr*psi1))/(C0^2*R0^2) + (2*gama*hbr*psi1*(b_bar - hr))/(C0*R0) + (gama*(R0 - hb)*(gama + 1)*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/(C0^2*R0^2) + (gama*(R0 - hb)*(b_bar - hr)^2*(gama + 1)*(gama + 2))/(C0^3*R0^4) - (2*gama*(R0 - hb)*(b_bar - hr)*(hr*psi1 - 1/R0)*(gama + 1))/(C0^2*R0^2) - (gama*hb*psi1*(b_bar - hr)^2*(gama + 1))/(C0^2*R0^2) - (betta*gama*hb*(R0 - hb)*(gama + 1)*((rho_r^2*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/C0 + (hr^2*(psi1*hb^2 + hb2/R0))/C0 - (hr2*(R0 - hb))/(C0*R0) + (2*hr*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0))/(C0*R0) - (betta*gama*hb*(R0 - hb)*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))^2*(gama + 1)*(gama + 2))/(C0*R0);
Ub2y =betta*gama*((2*hb*hby*(psi1*hb^2 + hb2/R0))/C0 + (hb2*hy*(psi1*hb^2 + hb2/R0))/C0 + (hb2*rho_y*(hby/R0 + hb*hy*psi1))/C0 + (hb^2*rho_y*(hb2y/R0 + 2*hb*hby*psi1 + hb2*hy*psi1))/C0 - (hb2y*(R0 - hb))/(C0*R0) + (hb^2*hy*(hb3/R0 + 3*hb*hb2*psi1))/C0) - hb2y*psi1 - (gama*(hb2y/R0 + 2*hb*hby*psi1 + hb2*hy*psi1))/(C0*R0) - betta*gama*((hb^2*(psi1*hb^2 + hb2/R0))/C0 - (hb2*(R0 - hb))/(C0*R0))*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1) - (gama*hy*psi1*(psi1*hb^2 + hb2/R0))/C0 - (2*gama*hb*psi1*(hby/R0 + hb*hy*psi1))/C0 + (2*gama*hby*psi1*(R0 - hb))/(C0*R0) + (gama*hb2*psi1*(R0 - hy))/(C0*R0) + (gama*(psi1*hb^2 + hb2/R0)*(R0 - hy)*(gama + 1))/(C0^2*R0^2) + (2*gama*(R0 - hb)*(hby/R0 + hb*hy*psi1)*(gama + 1))/(C0^2*R0^2) - (gama*hy*psi1*(R0 - hb)^2*(gama + 1))/(C0^2*R0^2) + (gama*(R0 - hb)^2*(R0 - hy)*(gama + 1)*(gama + 2))/(C0^3*R0^4) - (2*gama*hb*psi1*(R0 - hb)*(R0 - hy)*(gama + 1))/(C0^2*R0^2) - (2*betta*gama*hb*(R0 - hb)*(gama + 1)*((hb*hy*(psi1*hb^2 + hb2/R0))/C0 + (hb*rho_y*(hby/R0 + hb*hy*psi1))/C0 - (hby*(R0 - hb))/(C0*R0)))/(C0*R0) - (betta*gama*hb^2*(R0 - hb)^2*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1)*(gama + 2))/(C0^2*R0^2);
Uby2 =betta*gama*((hb*hy2*(psi1*hb^2 + hb2/R0))/C0 + (2*hby*hy*(psi1*hb^2 + hb2/R0))/C0 + (2*hby*rho_y*(hby/R0 + hb*hy*psi1))/C0 + (hb*rho_y^2*(hby2/R0 + hb*hy2*psi1 + 2*hby*hy*psi1))/C0 - (hby2*(R0 - hb))/(C0*R0) + (hb*hy^2*(hb3/R0 + 3*hb*hb2*psi1))/C0 + (2*hb*hy*rho_y*(hb2y/R0 + 2*hb*hby*psi1 + hb2*hy*psi1))/C0) - hby2*psi1 - (gama*(hby2/R0 + hb*hy2*psi1 + 2*hby*hy*psi1))/(C0*R0) - 2*betta*gama*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1)*((hb*hy*(psi1*hb^2 + hb2/R0))/C0 + (hb*rho_y*(hby/R0 + hb*hy*psi1))/C0 - (hby*(R0 - hb))/(C0*R0)) - (gama*hb*psi1*(psi1*hy^2 + hy2/R0 - 1))/C0 - (2*gama*hy*psi1*(hby/R0 + hb*hy*psi1))/C0 + (gama*hy2*psi1*(R0 - hb))/(C0*R0) + (2*gama*hby*psi1*(R0 - hy))/(C0*R0) + (gama*(R0 - hb)*(gama + 1)*(psi1*hy^2 + hy2/R0 - 1))/(C0^2*R0^2) + (2*gama*(R0 - hy)*(hby/R0 + hb*hy*psi1)*(gama + 1))/(C0^2*R0^2) - (gama*hb*psi1*(R0 - hy)^2*(gama + 1))/(C0^2*R0^2) + (gama*(R0 - hb)*(R0 - hy)^2*(gama + 1)*(gama + 2))/(C0^3*R0^4) - (2*gama*hy*psi1*(R0 - hb)*(R0 - hy)*(gama + 1))/(C0^2*R0^2) - (betta*gama*hb*(R0 - hb)*(gama + 1)*((hy^2*(psi1*hb^2 + hb2/R0))/C0 + (rho_y^2*(psi1*hy^2 + hy2/R0 - 1))/C0 + (2*hy*rho_y*(hby/R0 + hb*hy*psi1))/C0 - (hy2*(R0 - hb))/(C0*R0)))/(C0*R0) - (betta*gama*hb*(R0 - hb)*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))^2*(gama + 1)*(gama + 2))/(C0*R0);
Ur2y =betta*gama*((2*hr*hry*(psi1*hb^2 + hb2/R0))/C0 + (hr2*hy*(psi1*hb^2 + hb2/R0))/C0 + (hy*rho_r^2*(hb/R0 - (2*hbr)/R0 + hbr2/R0 + hb*hr2*psi1 + 2*hbr*hr*psi1))/C0 + (rho_r^2*rho_y*(hr2y/R0 - (2*hry)/R0 + hy/R0 + 2*hr*hry*psi1 + hr2*hy*psi1))/C0 + (hr2*rho_y*(hby/R0 + hb*hy*psi1))/C0 + (hr^2*rho_y*(hb2y/R0 + 2*hb*hby*psi1 + hb2*hy*psi1))/C0 - (hr2y*(R0 - hb))/(C0*R0) + (hr^2*hy*(hb3/R0 + 3*hb*hb2*psi1))/C0 + (2*hry*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 + (2*hr*rho_r*rho_y*(hbry/R0 - hby/R0 + hb*hry*psi1 + hby*hr*psi1 + hbr*hy*psi1))/C0 + (2*hr*hy*rho_r*(hb2r/R0 - hb2/R0 + 2*hb*hbr*psi1 + hb2*hr*psi1))/C0) - hr2y*psi1 - (2*gama*(hr*psi1 - 1/R0)*(hry/R0 - hy/R0 + hr*hy*psi1))/C0 - (gama*(hr2y/R0 - (2*hry)/R0 + hy/R0 + 2*hr*hry*psi1 + hr2*hy*psi1))/(C0*R0) - (gama*hy*psi1*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/C0 - betta*gama*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1)*((rho_r^2*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/C0 + (hr^2*(psi1*hb^2 + hb2/R0))/C0 - (hr2*(R0 - hb))/(C0*R0) + (2*hr*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0) - 2*betta*gama*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*((hr*hy*(psi1*hb^2 + hb2/R0))/C0 + (hr*rho_y*(hby/R0 + hb*hy*psi1))/C0 - (hry*(R0 - hb))/(C0*R0) + (hy*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 + (rho_r*rho_y*(hry/R0 - hy/R0 + hr*hy*psi1))/C0) + (gama*(hr2*psi1 + 1/R0)*(R0 - hy))/(C0*R0) - betta*gama*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))^2*(gama + 1)*(gama + 2) + (2*gama*(b_bar - hr)*(gama + 1)*(hry/R0 - hy/R0 + hr*hy*psi1))/(C0^2*R0^2) + (2*gama*hry*psi1*(b_bar - hr))/(C0*R0) + (gama*(R0 - hy)*(gama + 1)*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/(C0^2*R0^2) + (gama*(R0 - hy)*(b_bar - hr)^2*(gama + 1)*(gama + 2))/(C0^3*R0^4) - (2*gama*(R0 - hy)*(b_bar - hr)*(hr*psi1 - 1/R0)*(gama + 1))/(C0^2*R0^2) - (gama*hy*psi1*(b_bar - hr)^2*(gama + 1))/(C0^2*R0^2);
Ury2 =betta*gama*((hr*hy2*(psi1*hb^2 + hb2/R0))/C0 + (2*hry*hy*(psi1*hb^2 + hb2/R0))/C0 + (2*hry*rho_y*(hby/R0 + hb*hy*psi1))/C0 + (hr*rho_y^2*(hby2/R0 + hb*hy2*psi1 + 2*hby*hy*psi1))/C0 - (hry2*(R0 - hb))/(C0*R0) + (hr*hy^2*(hb3/R0 + 3*hb*hb2*psi1))/C0 + (hy2*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 + (hy^2*rho_r*(hb2r/R0 - hb2/R0 + 2*hb*hbr*psi1 + hb2*hr*psi1))/C0 + (rho_r*rho_y^2*(hry2/R0 - hy2/R0 + hr*hy2*psi1 + 2*hry*hy*psi1))/C0 + (2*hr*hy*rho_y*(hb2y/R0 + 2*hb*hby*psi1 + hb2*hy*psi1))/C0 + (2*hy*rho_r*rho_y*(hbry/R0 - hby/R0 + hb*hry*psi1 + hby*hr*psi1 + hbr*hy*psi1))/C0) - hry2*psi1 - (gama*(hr*psi1 - 1/R0)*(psi1*hy^2 + hy2/R0 - 1))/C0 - (gama*(hry2/R0 - hy2/R0 + hr*hy2*psi1 + 2*hry*hy*psi1))/(C0*R0) - (2*gama*hy*psi1*(hry/R0 - hy/R0 + hr*hy*psi1))/C0 - betta*gama*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*((hy^2*(psi1*hb^2 + hb2/R0))/C0 + (rho_y^2*(psi1*hy^2 + hy2/R0 - 1))/C0 + (2*hy*rho_y*(hby/R0 + hb*hy*psi1))/C0 - (hy2*(R0 - hb))/(C0*R0)) - 2*betta*gama*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1)*((hr*hy*(psi1*hb^2 + hb2/R0))/C0 + (hr*rho_y*(hby/R0 + hb*hy*psi1))/C0 - (hry*(R0 - hb))/(C0*R0) + (hy*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 + (rho_r*rho_y*(hry/R0 - hy/R0 + hr*hy*psi1))/C0) - betta*gama*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))^2*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*(gama + 2) + (2*gama*(R0 - hy)*(gama + 1)*(hry/R0 - hy/R0 + hr*hy*psi1))/(C0^2*R0^2) - (gama*(R0 - hy)^2*(hr*psi1 - 1/R0)*(gama + 1))/(C0^2*R0^2) + (2*gama*hry*psi1*(R0 - hy))/(C0*R0) + (gama*hy2*psi1*(b_bar - hr))/(C0*R0) + (gama*(b_bar - hr)*(gama + 1)*(psi1*hy^2 + hy2/R0 - 1))/(C0^2*R0^2) + (gama*(R0 - hy)^2*(b_bar - hr)*(gama + 1)*(gama + 2))/(C0^3*R0^4) - (2*gama*hy*psi1*(R0 - hy)*(b_bar - hr)*(gama + 1))/(C0^2*R0^2);
Ubry =betta*gama*((hb*hry*(psi1*hb^2 + hb2/R0))/C0 + (hby*hr*(psi1*hb^2 + hb2/R0))/C0 + (hbr*hy*(psi1*hb^2 + hb2/R0))/C0 + (hbr*rho_y*(hby/R0 + hb*hy*psi1))/C0 - (hbry*(R0 - hb))/(C0*R0) + (hby*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 + (hb*hr*rho_y*(hb2y/R0 + 2*hb*hby*psi1 + hb2*hy*psi1))/C0 + (hb*rho_r*rho_y*(hbry/R0 - hby/R0 + hb*hry*psi1 + hby*hr*psi1 + hbr*hy*psi1))/C0 + (hb*hr*hy*(hb3/R0 + 3*hb*hb2*psi1))/C0 + (hb*hy*rho_r*(hb2r/R0 - hb2/R0 + 2*hb*hbr*psi1 + hb2*hr*psi1))/C0) - hbry*psi1 - (gama*(hbry/R0 - hby/R0 + hb*hry*psi1 + hby*hr*psi1 + hbr*hy*psi1))/(C0*R0) - (gama*(hby/R0 + hb*hy*psi1)*(hr*psi1 - 1/R0))/C0 - betta*gama*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*((hb*hy*(psi1*hb^2 + hb2/R0))/C0 + (hb*rho_y*(hby/R0 + hb*hy*psi1))/C0 - (hby*(R0 - hb))/(C0*R0)) - (gama*hy*psi1*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 - (gama*hb*psi1*(hry/R0 - hy/R0 + hr*hy*psi1))/C0 - betta*gama*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1)*((hb*hr*(psi1*hb^2 + hb2/R0))/C0 - (hbr*(R0 - hb))/(C0*R0) + (hb*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0) + (gama*(R0 - hy)*(gama + 1)*(hbr/R0 - hb/R0 + hb*hr*psi1))/(C0^2*R0^2) + (gama*(R0 - hb)*(gama + 1)*(hry/R0 - hy/R0 + hr*hy*psi1))/(C0^2*R0^2) + (gama*hry*psi1*(R0 - hb))/(C0*R0) + (gama*hbr*psi1*(R0 - hy))/(C0*R0) + (gama*hby*psi1*(b_bar - hr))/(C0*R0) + (gama*(hby/R0 + hb*hy*psi1)*(b_bar - hr)*(gama + 1))/(C0^2*R0^2) - (gama*(R0 - hb)*(R0 - hy)*(hr*psi1 - 1/R0)*(gama + 1))/(C0^2*R0^2) + (gama*(R0 - hb)*(R0 - hy)*(b_bar - hr)*(gama + 1)*(gama + 2))/(C0^3*R0^4) - (betta*gama*hb*(R0 - hb)*(gama + 1)*((hr*hy*(psi1*hb^2 + hb2/R0))/C0 + (hr*rho_y*(hby/R0 + hb*hy*psi1))/C0 - (hry*(R0 - hb))/(C0*R0) + (hy*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 + (rho_r*rho_y*(hry/R0 - hy/R0 + hr*hy*psi1))/C0))/(C0*R0) - (gama*hb*psi1*(R0 - hy)*(b_bar - hr)*(gama + 1))/(C0^2*R0^2) - (gama*hy*psi1*(R0 - hb)*(b_bar - hr)*(gama + 1))/(C0^2*R0^2) - (betta*gama*hb*(R0 - hb)*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*(gama + 2))/(C0*R0);
 
 
Us2b =2*hb*psi1 - hs2b*psi1 - uy_ur_corr*(2*((betta*gama*hb*tr*ty*(R0 - hy)*(hbr/R0 - hb/R0 + hb*hr*psi1))/(C0^2*R0) + (betta*gama*hb*tr*ty*(hby/R0 + hb*hy*psi1)*(b_bar - hr))/(C0^2*R0))*(gama + 1) - (2*betta*gama*hb*tr*ty*(hbry/R0 - hby/R0 + hb*hry*psi1 + hby*hr*psi1 + hbr*hy*psi1))/C0 + (2*betta*gama*hb*tr*ty*(R0 - hb)*(gama + 1)*(hry/R0 - hy/R0 + hr*hy*psi1))/(C0^2*R0) + (2*betta*gama*hb*tr*ty*(R0 - hb)*(R0 - hy)*(b_bar - hr)*(gama + 1)*(gama + 2))/(C0^3*R0^3)) + betta*gama*((hb*(hs2b/R0 + hb*hs2*psi1))/C0 + (hb*hs2*(psi1*hb^2 + hb2/R0))/C0 - (hs2b*(R0 - hb))/(C0*R0)) - (gama*(hs2b/R0 + hb*hs2*psi1))/(C0*R0) + (betta*gama*hb*tr^2*(hb/R0 - (2*hbr)/R0 + hbr2/R0 + hb*hr2*psi1 + 2*hbr*hr*psi1))/C0 + (betta*gama*hb*ty^2*(hby2/R0 + hb*hy2*psi1 + 2*hby*hy*psi1))/C0 - (gama*hb*hs2*psi1)/(C0*R0) + (gama*hs2*psi1*(R0 - hb))/(C0*R0) + (gama*hs2*(R0 - hb)*(gama + 1))/(C0^2*R0^3) - (2*betta*gama*hb*psi2*(R0 - hb))/(C0*R0) - (betta*gama*hb*(hs2/(C0*R0) - (hs2*(R0 - hb))/(C0*R0))*(R0 - hb)*(gama + 1))/(C0*R0) - (betta*gama*hb*tr^2*(R0 - hb)*(gama + 1)*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/(C0^2*R0) - (betta*gama*hb*ty^2*(R0 - hb)*(gama + 1)*(psi1*hy^2 + hy2/R0 - 1))/(C0^2*R0) - (2*betta*gama*hb*ty^2*(R0 - hy)*(hby/R0 + hb*hy*psi1)*(gama + 1))/(C0^2*R0) - (2*betta*gama*hb*tr^2*(b_bar - hr)*(gama + 1)*(hbr/R0 - hb/R0 + hb*hr*psi1))/(C0^2*R0) - (betta*gama*hb*ty^2*(R0 - hb)*(R0 - hy)^2*(gama + 1)*(gama + 2))/(C0^3*R0^3) - (betta*gama*hb*tr^2*(R0 - hb)*(b_bar - hr)^2*(gama + 1)*(gama + 2))/(C0^3*R0^3);
Us2r =2*hr*psi1 - hs2r*psi1 - uy_ur_corr*((2*betta*gama*tr*ty*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*(hry/R0 - hy/R0 + hr*hy*psi1))/C0 - betta*gama*((2*rho_r*tr*ty*(hr2y/R0 - (2*hry)/R0 + hy/R0 + 2*hr*hry*psi1 + hr2*hy*psi1))/C0 + (2*hr*tr*ty*(hbry/R0 - hby/R0 + hb*hry*psi1 + hby*hr*psi1 + hbr*hy*psi1))/C0) + (2*betta*gama*ty*((rho_r*tr*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/C0 + (hr*tr*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0)*(R0 - hy)*(gama + 1))/(C0*R0) + (2*betta*gama*tr*(b_bar - hr)*((hr*ty*(hby/R0 + hb*hy*psi1))/C0 + (rho_r*ty*(hry/R0 - hy/R0 + hr*hy*psi1))/C0)*(gama + 1))/(C0*R0) + (2*betta*gama*tr*ty*(R0 - hy)*(b_bar - hr)*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*(gama + 2))/(C0^2*R0^2)) + betta*gama*((rho_r*(hs2r/R0 - hs2/R0 + hr*hs2*psi1))/C0 + (hr*(hs2b/R0 + hb*hs2*psi1))/C0 + (hr*hs2*(psi1*hb^2 + hb2/R0))/C0 - (hs2r*(R0 - hb))/(C0*R0) + (hs2*rho_r*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0) + betta*gama*((hr*ty^2*(hby2/R0 + hb*hy2*psi1 + 2*hby*hy*psi1))/C0 + (rho_r*ty^2*(hry2/R0 - hy2/R0 + hr*hy2*psi1 + 2*hry*hy*psi1))/C0) + betta*gama*((rho_r*tr^2*((3*hr)/R0 - b_bar/R0 - (3*hr2)/R0 + hr3/R0 + 3*hr*hr2*psi1))/C0 + (hr*tr^2*(hb/R0 - (2*hbr)/R0 + hbr2/R0 + hb*hr2*psi1 + 2*hbr*hr*psi1))/C0) - (gama*(hs2r/R0 - hs2/R0 + hr*hs2*psi1))/(C0*R0) - 2*betta*gama*psi2*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0)) - (gama*hs2*(hr*psi1 - 1/R0))/(C0*R0) - betta*gama*(hs2/(C0*R0) - (hs2*(R0 - hb))/(C0*R0))*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1) + (gama*hs2*psi1*(b_bar - hr))/(C0*R0) + (gama*hs2*(b_bar - hr)*(gama + 1))/(C0^2*R0^3) - (betta*gama*tr^2*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/C0 - (betta*gama*ty^2*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*(psi1*hy^2 + hy2/R0 - 1))/C0 - (2*betta*gama*tr*((rho_r*tr*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/C0 + (hr*tr*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0)*(b_bar - hr)*(gama + 1))/(C0*R0) - (2*betta*gama*ty*(R0 - hy)*((hr*ty*(hby/R0 + hb*hy*psi1))/C0 + (rho_r*ty*(hry/R0 - hy/R0 + hr*hy*psi1))/C0)*(gama + 1))/(C0*R0) - (betta*gama*ty^2*(R0 - hy)^2*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*(gama + 2))/(C0^2*R0^2) - (betta*gama*tr^2*(b_bar - hr)^2*((hr*(R0 - hb))/(C0*R0) + (rho_r*(b_bar - hr))/(C0*R0))*(gama + 1)*(gama + 2))/(C0^2*R0^2);
Us2y =2*hy*psi1 - hs2y*psi1 - uy_ur_corr*((2*betta*gama*tr*ty*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1)*(hry/R0 - hy/R0 + hr*hy*psi1))/C0 - betta*gama*((2*hy*tr*ty*(hbry/R0 - hby/R0 + hb*hry*psi1 + hby*hr*psi1 + hbr*hy*psi1))/C0 + (2*rho_y*tr*ty*(hry2/R0 - hy2/R0 + hr*hy2*psi1 + 2*hry*hy*psi1))/C0) + (2*betta*gama*ty*((hy*tr*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 + (rho_y*tr*(hry/R0 - hy/R0 + hr*hy*psi1))/C0)*(R0 - hy)*(gama + 1))/(C0*R0) + (2*betta*gama*tr*((hy*ty*(hby/R0 + hb*hy*psi1))/C0 + (rho_y*ty*(psi1*hy^2 + hy2/R0 - 1))/C0)*(b_bar - hr)*(gama + 1))/(C0*R0) + (2*betta*gama*tr*ty*(R0 - hy)*(b_bar - hr)*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1)*(gama + 2))/(C0^2*R0^2)) + betta*gama*((hy*tr^2*(hb/R0 - (2*hbr)/R0 + hbr2/R0 + hb*hr2*psi1 + 2*hbr*hr*psi1))/C0 + (rho_y*tr^2*(hr2y/R0 - (2*hry)/R0 + hy/R0 + 2*hr*hry*psi1 + hr2*hy*psi1))/C0) + betta*gama*((hy*(hs2b/R0 + hb*hs2*psi1))/C0 + (rho_y*(hs2y/R0 + hs2*hy*psi1))/C0 + (hs2*hy*(psi1*hb^2 + hb2/R0))/C0 + (hs2*rho_y*(hby/R0 + hb*hy*psi1))/C0 - (hs2y*(R0 - hb))/(C0*R0)) + betta*gama*((hy*ty^2*(hby2/R0 + hb*hy2*psi1 + 2*hby*hy*psi1))/C0 + (rho_y*ty^2*(hy3/R0 + 3*hy*hy2*psi1 - 1))/C0) - 2*betta*gama*psi2*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0)) - (gama*(hs2y/R0 + hs2*hy*psi1))/(C0*R0) - betta*gama*(hs2/(C0*R0) - (hs2*(R0 - hb))/(C0*R0))*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1) - (gama*hs2*hy*psi1)/(C0*R0) + (gama*hs2*psi1*(R0 - hy))/(C0*R0) + (gama*hs2*(R0 - hy)*(gama + 1))/(C0^2*R0^3) - (betta*gama*tr^2*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1)*(psi1*hr^2 - (2*hr)/R0 + b_bar/R0 + hr2/R0))/C0 - (betta*gama*ty^2*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1)*(psi1*hy^2 + hy2/R0 - 1))/C0 - (2*betta*gama*ty*((hy*ty*(hby/R0 + hb*hy*psi1))/C0 + (rho_y*ty*(psi1*hy^2 + hy2/R0 - 1))/C0)*(R0 - hy)*(gama + 1))/(C0*R0) - (2*betta*gama*tr*((hy*tr*(hbr/R0 - hb/R0 + hb*hr*psi1))/C0 + (rho_y*tr*(hry/R0 - hy/R0 + hr*hy*psi1))/C0)*(b_bar - hr)*(gama + 1))/(C0*R0) - (betta*gama*ty^2*(R0 - hy)^2*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1)*(gama + 2))/(C0^2*R0^2) - (betta*gama*tr^2*(b_bar - hr)^2*((hy*(R0 - hb))/(C0*R0) + (rho_y*(R0 - hy))/(C0*R0))*(gama + 1)*(gama + 2))/(C0^2*R0^2);
 

y = [Ub3;Ur3;Uy3;Ub2r;Ubr2;Ub2y;Uby2;Ur2y;Ury2;Ubry;Us2b;Us2r;Us2y];